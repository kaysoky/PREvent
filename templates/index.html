{% extends "rest_framework/base.html" %}
{% load url from future %}
{% load staticfiles %}
{% load rest_framework %}

{% block body %}
<body class="{% block bodyclass %}{% endblock %}">

    <div class="wrapper">

        {% block navbar %}
            <div class="navbar navbar-static-top {% block bootstrap_navbar_variant %}navbar-inverse{% endblock %}">
                <div class="container">
                    <span>
                        {% block branding %}
                            <a class='navbar-brand' rel="nofollow" href='/'>
                                PREvent
                            </a>
                        {% endblock %}
                    </span>
                    <ul class="nav navbar-nav pull-right">
                        {% block userlinks %}
                            {% if user.is_authenticated %}
                                {% optional_logout request user %}
                            {% else %}
                                <li><a href="register/">Register</a></li>
                                {% optional_login request %}
                            {% endif %}
                        {% endblock %}
                    </ul>
                </div>
            </div>
        {% endblock %}

        <div class="container">
            <ul class="breadcrumb"></ul>
            <div id="content">
                <div class="content-main">
                    <div class="page-header">
                        <h1>Map UI (in development)</h1>
                    </div>
                    <div id="map-canvas" style="height: 500px"></div>
                    <div>
                        <div id="panel">
                          <button onclick="toggleTempMap()">Temperature</button>
                          <button onclick="toggleHumiMap()">Humidity</button>
                          <button onclick="toggleVocsMap()">Volatile Organic</button>
                          <button onclick="togglePartMap()">Particle 2.5</button>
                          <h2>Average Temperature:</h2> <h2 id="tempMean"></h2>
                          <h2>Average Humidity:</h2> <h2 id="humiMean"></h2>
                          <h2>Average Particulate:</h2> <h2 id="partMean"></h2>
                          <h2>Average Volatile Organic:</h2> <h2 id="vocsMean"></h2>
                        </div>
                    </div>
                </div>
            <div>
        <div>
    </div><!-- ./wrapper -->

    {% block script %}
        <script src="{% static 'rest_framework/js/jquery-1.8.1-min.js' %}"></script>
        <script src="{% static 'rest_framework/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'rest_framework/js/prettify-min.js' %}"></script>
        <script src="{% static 'rest_framework/js/default.js' %}"></script>
        <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true_or_false">
        </script>
        <script>
            // Fetch data from the server
            var temp = [];
            var humi = [];
            var part = [];
            var vocs = [];
            function fetchData() {
            	$.get('/data/').done(function(data) {
	                for (var index in data) {
	                    var coord = new google.maps.LatLng(data[index].ycoord, data[index].xcoord);
	                    temp.push({ location: coord, weight: data[index].temperature });
	                    humi.push({ location: coord, weight: data[index].humidity });
	                    part.push({ location: coord, weight: data[index].particulate });
	                    vocs.push({ location: coord, weight: data[index].gas });
	                }
	                averages();
	                initialize();
	            });
	        }
			function averages()	{
				var tempMean = 0;
	        	var humiMean = 0;
	        	var partMean = 0;
	        	var vocsMean = 0;
				for(var i = 0; i < temp.length; i++) {
					tempMean = tempMean + temp[i]['weight']
					humiMean = humiMean + humi[i]['weight']
					partMean = partMean + part[i]['weight']
					vocsMean = vocsMean + vocs[i]['weight']
				}
				document.getElementById("tempMean").innerHTML = tempMean/temp.length;
				document.getElementById("humiMean").innerHTML = humiMean/temp.length;
				document.getElementById("partMean").innerHTML = partMean/temp.length;
				document.getElementById("vocsMean").innerHTML = vocsMean/temp.length;
			};	        

            var map;
            var tempHeatmap;
            var humiHeatmap;
            var partHeatmap;
            var vocsHeatmap;
            function initialize() {
                var mapOptions = {
                    zoom: 9,
                    // TEMP: Center map over Seattle
                    center: new google.maps.LatLng(47.450580, -122.307496),
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
              
                // Initialize Google Maps layer
                map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

				tempHeatmap = new google.maps.visualization.HeatmapLayer({
                    data: new google.maps.MVCArray(temp)
                });
                humiHeatmap = new google.maps.visualization.HeatmapLayer({
                    data: new google.maps.MVCArray(humi)
                });
                partHeatmap = new google.maps.visualization.HeatmapLayer({
                    data: new google.maps.MVCArray(part)
                });
                vocsHeatmap = new google.maps.visualization.HeatmapLayer({
                    data: new google.maps.MVCArray(vocs)
                });
            }

            function toggleTempMap() {
	            tempHeatmap.setMap(map);
	            humiHeatmap.setMap(null);
	            partHeatmap.setMap(null);
	            vocsHeatmap.setMap(null);
            }
            function toggleHumiMap() {
	            tempHeatmap.setMap(null);
	            humiHeatmap.setMap(map);
	            partHeatmap.setMap(null);
	            vocsHeatmap.setMap(null);
            }
            function togglePartMap() {
	            tempHeatmap.setMap(null);
	            humiHeatmap.setMap(null);
	            partHeatmap.setMap(map);
	            vocsHeatmap.setMap(null);
            }
            function toggleVocsMap() {
	            tempHeatmap.setMap(null);
	            humiHeatmap.setMap(null);
	            partHeatmap.setMap(null);
	            vocsHeatmap.setMap(map);
            }

            google.maps.event.addDomListener(window, 'load', fetchData);

        </script>
    {% endblock %}
  </body>
</html>
{% endblock %}
